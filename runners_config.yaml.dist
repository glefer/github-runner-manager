# Global configuration for GitHub runners
runners_defaults:
  base_image: ghcr.io/actions/actions-runner:2.328.0  # Common base image
  org_url: https://github.com/it-room
  # The GitHub token must be set in the GITHUB_TOKEN environment variable (see .env)

runners:
  - id: sample
    name_prefix: my-runner-sample
    labels: [my-runner-set-sample, sample]
    nb: 2
    build_image: ./config/Dockerfile.sample
    techno: php
    techno_version: 8.3

scheduler:
  check_interval: "15s"           # Update check frequency
  time_window: "07:00-23:00"     # Allowed time window for automatic actions
  days: ["mon", "wed", "fri"]    # Execution days
  actions:
    - check
    - build
    - deploy
  max_retries: 3


webhooks:
  # General webhook configuration
  enabled: true
  timeout: 10  # Global timeout in seconds
  retry_count: 3
  retry_delay: 5  # Seconds
  
  # Slack specific configuration
  slack:
    enabled: true
    webhook_url: "https://hooks.slack.com/services/T00000000/B00000000/XXXXXXXXXXXXXXXXXXXXXXXX"
    username: "GitHub Runner Bot"
    timeout: 10  # Slack-specific timeout
    
    # List of events to notify
    events:
      - runner_started
      - runner_stopped
      - runner_error
      - build_started
      - build_completed
      - build_failed
      - update_available
      - update_applied
  
    # Message templates for different events
    templates:
      # Default template (used if no specific template)
      default:
        title: "GitHub Runner Manager Notification"
        text: "An event has occurred"
        color: "#36a64f"  # Green
        use_attachment: true
        fields: []
        
      # Runner started
      runner_started:
        title: "Runner Started"
        text: "Runner *{runner_name}* started successfully"
        color: "#36a64f"  # Green
        fields:
          - name: "Labels"
            value: "{labels}"
            short: true

          
      # Runner stopped
      runner_stopped:
        title: "Runner Stopped"
        text: "Runner *{runner_name}* has been stopped"
        color: "#ff9000"  # Orange
        fields: []
            
      # Runner error
      runner_error:
        title: "⚠️ Runner Error"
        text: "An error occurred with runner *{runner_name}*"
        color: "#ff0000"  # Red
        fields:
          - name: "Runner ID"
            value: "{runner_id}"
            short: true
          - name: "Error"
            value: "```{error_message}```"
            short: false
            
      # Build started
      build_started:
        title: "Build Started"
        text: "Image build *{image_name}* started"
        color: "#3AA3E3"  # Blue
        fields:
          - name: "Base image"
            value: "{base_image}"
            short: true
          - name: "Technology"
            value: "{techno} {techno_version}"
            short: true
            
      # Build completed
      build_completed:
        title: "Build Completed"
        text: "Image build *{image_name}* completed successfully in {duration}s"
        color: "#36a64f"  # Green
        fields:
          - name: "Image"
            value: "{image_name}"
            short: true
          - name: "Size"
            value: "{image_size}"
            short: true
            
      # Build failed
      build_failed:
        title: "⚠️ Build Failed"
        text: "Image build *{image_name}* failed"
        color: "#ff0000"  # Red
        fields:
          - name: "Error"
            value: "```{error_message}```"
            short: false
            
      # Update available
      update_available:
        title: "Update Available"
        text: "An update is available for image *{image_name}*"
        color: "#3AA3E3"  # Blue
        fields:
          - name: "Current version"
            value: "{current_version}"
            short: true
          - name: "New version"
            value: "{available_version}"
            short: true
            
      # Update applied
      update_applied:
        title: "Update Applied"
        text: "Image *{image_name}* has been updated successfully"
        color: "#36a64f"  # Green
        fields:
          - name: "Old version"
            value: "{old_version}"
            short: true
          - name: "New version"
            value: "{new_version}"
            short: true
          - name: "Affected runners"
            value: "{affected_runners}"
            short: false